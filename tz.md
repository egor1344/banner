# ТЗ на сервис "Ротация баннеров"


## Общее описание

Сервис "Ротация баннеров" предназначен для выбора наиболее эффективных (кликабельных) баннеров,
в условиях меняющихся предпочтений пользователей и набора баннеров.
Предположим, что на сайте есть место для показа баннеров (слот) и есть набор баннеров, которые 
конкурируют за право показа в этом месте. Набор баннеров постоянно обновляется - добавляются новые,
старые удаляются. Так же у пользователя меняются предпочтения - если им показывать все время один
и тот же баннер, пользователь перестает его замечать. Задача сервиса - осуществлять о "ротацию" баннеров, 
показывая те, которые наиболее вероятно приведут к переходу. 
Для этого предполагается использовать алгоритм "Многорукий бандит": https://habr.com/ru/company/surfingbird/blog/168611/
Кроме того пользователи не однородны - их можно условно разделить на социально-демографические группы. 
В разных группах пользователей могут быть разные предпочтения.


## Архитектура

Сервис состоит из API и базы данных в которой хранится информация о баннерах.
Сервис должен предоставлять GRPC или REST API.

## Описание сущностей

### Слот
Слот - место на сайте, на котором мы показываем баннер
* ID

### Баннер
Баннер - рекламный / информационный элемент, который показывается в слоте.
* ID
* ID слота
* Описание

### Соц-дем. группа пользователей
Соц-дем. группа - это группа пользователей сайта со схожими интересами, например "девушки 20-25" или "дедушки 80+"
* ID

### Статистика баннера
* ID баннера
* ID соц-дем. группы
* кол-во показов
* кол-во кликов

## Описание методов

### Добавить баннер
* ID баннера
* ID слота
* Описание
Добавляет новый баннер в ротацию в данном слоте

### Удалить баннер
* ID баннера
Удаляет баннер из ротации

### Засчитать переход
* ID баннера
* ID соц-дем. группы
Увеличивает счетчик переходов на 1 для указанного баннера в указанной группе.

### Выбрать баннер для показа
* ID слота
* ID соц-дем. группы

Возвращает:
* ID баннера

Основной метод. Возвращает баннер который следует показать в данный момент в указанном
слоте для указанной соц-дем. группы. Увеличивает число показов баннера в группе.

## Выгрузка статистики

Микросервис должен отправлять события кликов и показов в очередь (например kafka) для дальнейшей обработки
в аналитических системах. 
Формат событий следующий:
* Тип: клик или показ
* ID слота
* ID баннера
* ID соц.дем группы
* Дата и время
  
## Развертывание

Развертывание микросервиса должно осуществляться командой `docker-compose up` в директории с проектом.

## Тестирование

Алгоритм "многорукого бандита" рекомендуется выделить в отдельный модуль и покрыть Unit-тестами.
Также необходимо написать интеграционные тесты проверяющие работу сервиса через его API.
При тестировании необходимо проверить сценарии:
* Перебор всех: после большого количества показов, каждый баннер должен быть показан хотя один раз
* Выбор популярных: если на один из баннеров кликают, у него должно быть существенно больше показов чем у остальных

## Разбалловка

Максимум - 10 баллов

* Реализован алгоритм "многорукого бандита" - 1 балл (done)
* Реализованo разделение на "слоты" и "соц.дем. группы" - 1 балл (вроде сделал, но формулировка не понятна)
* Реализовано API сервиса - 1 балл (в процессе)
* Реализована отправка статистики в очередь - 1 балл 
* Код правильно стрктурирован, логика отделена от адаптеров - 1 балл
* Код проходит проверку go vet, golint и race detector - 1 балл
* Написаны тесты - 1 балл (в процессе)
* Тесты адекватны и полностью покрывают фукнционал - 1 балл
* Проект запускает и тестируется в docker-compose - 1 балл
* Проект возможно запустить через `make run` и протестировать через `make test` - 1 балл
